<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Praxida 2.0 - Vollst√§ndiges Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #A8E6CF 0%, #4CAF50 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            min-height: 100vh;
        }
        
        .sidebar {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .main-content {
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            min-height: calc(100vh - 40px);
        }
        
        .logo h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .logo .version {
            background: linear-gradient(135deg, #4CAF50, #A8E6CF);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 600;
            display: inline-block;
        }

        .user-info {
            background: linear-gradient(135deg, #f8f9ff, #eef2ff);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #333, #555);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin: 0 auto 8px;
        }
        
        .nav-tabs {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .nav-tab {
            padding: 12px 16px;
            border: none;
            background: #f8f9ff;
            color: #333;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
        }
        
        .nav-tab:hover {
            background: #eef2ff;
            transform: translateX(3px);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #333, #555);
            color: white;
            transform: translateX(3px);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .section-title {
            font-size: 26px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .section-subtitle {
            color: #666;
            font-size: 14px;
        }

        /* === SHARED COMPONENTS === */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #333, #555);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #81C784);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #FFB74D);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336, #e57373);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .input-field {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #333;
        }

        .card {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: #ddd;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        /* === THERAPY PLANNING === */
        .plan-editor {
            display: grid;
            gap: 20px;
        }

        .plan-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
        }

        .plan-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .goal-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #4CAF50;
        }

        .goal-item strong {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }

        /* === CALENDAR === */
        .calendar-container {
            display: grid;
            gap: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: #f8f9ff;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .calendar-day:hover {
            background: #eef2ff;
            transform: scale(1.05);
        }

        .calendar-day.today {
            background: linear-gradient(135deg, #4CAF50, #81C784);
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-appointments {
            border: 2px solid #FF9800;
        }

        .appointment-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #FF9800;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .appointments-list {
            margin-top: 20px;
        }

        .appointment-item {
            background: white;
            border-left: 4px solid #FF9800;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .appointment-time {
            font-weight: bold;
            color: #FF9800;
            margin-bottom: 5px;
        }

        /* === TODOS === */
        .todo-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .todo-filter {
            padding: 8px 16px;
            border: 2px solid #eee;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .todo-filter.active {
            background: #333;
            color: white;
            border-color: #333;
        }

        .todo-item {
            background: white;
            border: 2px solid #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .todo-item:hover {
            border-color: #ddd;
        }

        .todo-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .todo-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .todo-content {
            flex: 1;
        }

        .todo-priority {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }

        .todo-priority.high {
            background: #ffebee;
            color: #c62828;
        }

        .todo-priority.medium {
            background: #fff3e0;
            color: #e65100;
        }

        .todo-priority.low {
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* === CHAT === */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9ff;
        }

        .chat-message {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .chat-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
        }

        .chat-message.assistant .chat-bubble {
            background: white;
            border: 2px solid #eee;
        }

        .chat-message.user .chat-bubble {
            background: linear-gradient(135deg, #333, #555);
            color: white;
        }

        .chat-input-area {
            padding: 20px;
            background: white;
            border-top: 2px solid #f0f0f0;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 14px;
        }

        /* === TEAM === */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .team-member-card {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .team-member-card:hover {
            border-color: #333;
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .team-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #81C784);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
        }

        .team-role {
            display: inline-block;
            padding: 5px 12px;
            background: #f0f0f0;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 10px;
        }

        .team-role.admin {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .team-role.therapeut {
            background: linear-gradient(135deg, #4CAF50, #81C784);
            color: white;
        }

        /* === MODAL === */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 13px;
            color: #333;
        }

        .logout-btn {
            background: #f1f1f1;
            color: #666;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
            width: 100%;
        }

        .logout-btn:hover {
            background: #ddd;
        }

        .admin-link {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
            text-decoration: none;
            display: inline-block;
            width: 100%;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1>üåø Praxida</h1>
                <span class="version">v2.0 EXTENDED</span>
            </div>

            <div class="user-info">
                <div class="user-avatar" id="userAvatar">?</div>
                <div style="font-weight: 600; margin-bottom: 5px;" id="userName">Laden...</div>
                <div style="font-size: 12px; color: #666;" id="userRole">Rolle</div>
                <button class="logout-btn" onclick="logout()">Abmelden</button>
                <a href="/admin" class="admin-link" id="adminLink" style="display:none;">Admin Dashboard</a>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab" onclick="showSection('overview', this)">
                    <span>üìä</span> Dashboard
                </button>
                <button class="nav-tab" onclick="showSection('clients', this)">
                    <span>üë§</span> Klient:innen
                </button>
                <button class="nav-tab" onclick="showSection('planning', this)">
                    <span>üìã</span> Therapieplanung
                </button>
                <button class="nav-tab" onclick="showSection('calendar', this)">
                    <span>üìÖ</span> Termine
                </button>
                <button class="nav-tab" onclick="showSection('todos', this)">
                    <span>‚úÖ</span> To-Dos
                </button>
                <button class="nav-tab" onclick="showSection('chat', this)">
                    <span>üí¨</span> KI-Chat
                </button>
                <button class="nav-tab" onclick="showSection('team', this)">
                    <span>üë•</span> Team
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Overview Section -->
            <div id="overview" class="content-section active">
                <div class="section-header">
                    <h2 class="section-title">Dashboard</h2>
                    <p class="section-subtitle">Willkommen in Praxida 2.0 Extended</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div class="card">
                        <h3 style="color: #4CAF50; margin-bottom: 10px;">Klient:innen</h3>
                        <div style="font-size: 36px; font-weight: bold; margin: 10px 0;">0</div>
                        <p style="color: #666; font-size: 13px;">Aktive Klienten</p>
                    </div>
                    <div class="card">
                        <h3 style="color: #FF9800; margin-bottom: 10px;">Termine Heute</h3>
                        <div style="font-size: 36px; font-weight: bold; margin: 10px 0;">0</div>
                        <p style="color: #666; font-size: 13px;">Geplante Sitzungen</p>
                    </div>
                    <div class="card">
                        <h3 style="color: #f44336; margin-bottom: 10px;">Offene To-Dos</h3>
                        <div style="font-size: 36px; font-weight: bold; margin: 10px 0;">0</div>
                        <p style="color: #666; font-size: 13px;">Ausstehende Aufgaben</p>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">üöÄ Neue Features verf√ºgbar!</h3>
                    <p style="color: #666; margin-bottom: 15px;">Praxida 2.0 Extended bringt dir:</p>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úÖ Vollst√§ndige Therapieplanung</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">üìÖ Intelligentes Terminmanagement</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úÖ To-Do Verwaltung</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">üí¨ KI-Assistenz Chat</li>
                        <li style="padding: 8px 0;">üë• Team-Kollaboration</li>
                    </ul>
                </div>
            </div>

            <!-- Clients Section (Placeholder) -->
            <div id="clients" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Klient:innenverwaltung</h2>
                    <p class="section-subtitle">Alle Klienten im √úberblick</p>
                </div>
                <p style="padding: 40px; text-align: center; color: #666;">
                    Die Klientenverwaltung wird aus der Hauptversion geladen...
                </p>
            </div>

            <!-- === THERAPY PLANNING === -->
            <div id="planning" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Therapieplanung</h2>
                    <p class="section-subtitle">KI-gest√ºtzte Behandlungsplanung</p>
                    <button class="btn btn-primary" style="margin-top: 15px;" onclick="showModal('planModal')">
                        <span>‚ûï</span> Neuer Therapieplan
                    </button>
                </div>

                <div class="plan-editor">
                    <div class="plan-section">
                        <h3>üìã Aktuelle Therapiepl√§ne</h3>
                        <div id="therapyPlansList">
                            <div class="card">
                                <h4 style="margin-bottom: 10px;">Beispiel-Therapieplan</h4>
                                <p style="color: #666; font-size: 13px; margin-bottom: 10px;">
                                    Klient: Max M. | Start: 01.12.2024 | Dauer: 12 Wochen
                                </p>
                                <div class="goal-item">
                                    <strong>Ziel 1:</strong> Reduktion von Angstsymptomen
                                    <p style="font-size: 12px; color: #666; margin-top: 5px;">Methode: Kognitive Verhaltenstherapie</p>
                                </div>
                                <div class="goal-item">
                                    <strong>Ziel 2:</strong> Verbesserung der Emotionsregulation
                                    <p style="font-size: 12px; color: #666; margin-top: 5px;">Methode: Achtsamkeits√ºbungen</p>
                                </div>
                                <button class="btn btn-success" style="margin-top: 10px;">Plan bearbeiten</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === CALENDAR === -->
            <div id="calendar" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Terminmanagement</h2>
                    <p class="section-subtitle">Intelligente Terminplanung</p>
                    <button class="btn btn-primary" style="margin-top: 15px;" onclick="showModal('appointmentModal')">
                        <span>‚ûï</span> Neuer Termin
                    </button>
                </div>

                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="btn btn-secondary" onclick="previousMonth()">‚Üê Zur√ºck</button>
                        <h3 id="currentMonth">Dezember 2024</h3>
                        <button class="btn btn-secondary" onclick="nextMonth()">Weiter ‚Üí</button>
                    </div>

                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar days will be generated by JavaScript -->
                    </div>

                    <div class="appointments-list">
                        <h3 style="margin-bottom: 15px;">Heutige Termine</h3>
                        <div id="todayAppointments">
                            <div class="appointment-item">
                                <div>
                                    <div class="appointment-time">10:00 - 11:00</div>
                                    <strong>Max M.</strong>
                                    <p style="font-size: 12px; color: #666; margin-top: 5px;">Einzeltherapie - Raum 1</p>
                                </div>
                                <button class="btn btn-success">Details</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === TODOS === -->
            <div id="todos" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">To-Dos & Aufgaben</h2>
                    <p class="section-subtitle">Intelligente Aufgabenverwaltung</p>
                    <button class="btn btn-primary" style="margin-top: 15px;" onclick="showModal('todoModal')">
                        <span>‚ûï</span> Neue Aufgabe
                    </button>
                </div>

                <div class="todo-filters">
                    <button class="todo-filter active" onclick="filterTodos('all', this)">Alle</button>
                    <button class="todo-filter" onclick="filterTodos('today', this)">Heute</button>
                    <button class="todo-filter" onclick="filterTodos('week', this)">Diese Woche</button>
                    <button class="todo-filter" onclick="filterTodos('high', this)">Hohe Priorit√§t</button>
                </div>

                <div id="todosList">
                    <div class="todo-item" data-priority="high" data-date="2024-12-08">
                        <input type="checkbox" class="todo-checkbox" onchange="toggleTodo(this)">
                        <div class="todo-content">
                            <strong>Therapieprotokoll f√ºr Max M. erstellen</strong>
                            <p style="font-size: 12px; color: #666; margin-top: 3px;">F√§llig: Heute, 18:00</p>
                        </div>
                        <span class="todo-priority high">HOCH</span>
                        <button class="btn btn-danger" style="padding: 6px 12px; font-size: 11px;">L√∂schen</button>
                    </div>

                    <div class="todo-item" data-priority="medium" data-date="2024-12-09">
                        <input type="checkbox" class="todo-checkbox" onchange="toggleTodo(this)">
                        <div class="todo-content">
                            <strong>Abrechnung Q4 vorbereiten</strong>
                            <p style="font-size: 12px; color: #666; margin-top: 3px;">F√§llig: Morgen, 12:00</p>
                        </div>
                        <span class="todo-priority medium">MITTEL</span>
                        <button class="btn btn-danger" style="padding: 6px 12px; font-size: 11px;">L√∂schen</button>
                    </div>

                    <div class="todo-item" data-priority="low" data-date="2024-12-15">
                        <input type="checkbox" class="todo-checkbox" onchange="toggleTodo(this)">
                        <div class="todo-content">
                            <strong>Fortbildung Traumatherapie buchen</strong>
                            <p style="font-size: 12px; color: #666; margin-top: 3px;">F√§llig: 15.12.2024</p>
                        </div>
                        <span class="todo-priority low">NIEDRIG</span>
                        <button class="btn btn-danger" style="padding: 6px 12px; font-size: 11px;">L√∂schen</button>
                    </div>
                </div>
            </div>

            <!-- === KI-CHAT === -->
            <div id="chat" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">KI-Assistenz Chat</h2>
                    <p class="section-subtitle">Professionelle Beratung zu Therapiemethoden</p>
                </div>

                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message assistant">
                            <div class="chat-bubble">
                                üëã Hallo! Ich bin dein KI-Assistent f√ºr therapeutische Fragestellungen. 
                                Ich kann dir helfen bei:
                                <ul style="margin-top: 10px; padding-left: 20px;">
                                    <li>Therapiemethoden und Interventionen</li>
                                    <li>Diagnostischen √úberlegungen</li>
                                    <li>Behandlungsplanung</li>
                                    <li>Supervision und Fallbesprechung</li>
                                </ul>
                                Wie kann ich dir heute helfen?
                            </div>
                        </div>
                    </div>

                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="chatInput" 
                               placeholder="Stelle eine Frage zu Therapiemethoden, Diagnosen, etc..."
                               onkeypress="if(event.key==='Enter') sendChatMessage()">
                        <button class="btn btn-primary" onclick="sendChatMessage()">
                            <span>üì§</span> Senden
                        </button>
                    </div>
                </div>
            </div>

            <!-- === TEAM === -->
            <div id="team" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Team-Kollaboration</h2>
                    <p class="section-subtitle">DSGVO-konforme Zusammenarbeit</p>
                    <button class="btn btn-primary" style="margin-top: 15px;" onclick="showModal('teamModal')">
                        <span>‚ûï</span> Teammitglied hinzuf√ºgen
                    </button>
                </div>

                <div class="team-grid" id="teamGrid">
                    <!-- Team members will be loaded here -->
                    <div class="team-member-card">
                        <div class="team-avatar">DA</div>
                        <h3 style="margin-bottom: 5px;">Dr. Demo Admin</h3>
                        <p style="color: #666; font-size: 13px; margin-bottom: 10px;">admin@demo-praxis.de</p>
                        <span class="team-role admin">Admin</span>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-success" style="padding: 8px 16px; font-size: 12px;">Bearbeiten</button>
                        </div>
                    </div>

                    <div class="team-member-card">
                        <div class="team-avatar" style="background: linear-gradient(135deg, #FF9800, #FFB74D);">ST</div>
                        <h3 style="margin-bottom: 5px;">Dr. Sarah Therapeutin</h3>
                        <p style="color: #666; font-size: 13px; margin-bottom: 10px;">therapeut@demo-praxis.de</p>
                        <span class="team-role therapeut">Therapeut</span>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-success" style="padding: 8px 16px; font-size: 12px;">Bearbeiten</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- === MODALS === -->

    <!-- Therapy Plan Modal -->
    <div id="planModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Neuer Therapieplan</h2>
            </div>
            <form onsubmit="createTherapyPlan(event)">
                <div class="form-group">
                    <label class="form-label">Klient:in w√§hlen</label>
                    <select class="input-field" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="1">Max M.</option>
                        <option value="2">Anna S.</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Therapieziel</label>
                    <textarea class="input-field" rows="3" placeholder="Hauptziel der Therapie..." required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Therapiemethode</label>
                    <select class="input-field" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="kbt">Kognitive Verhaltenstherapie</option>
                        <option value="tiefenpsychologie">Tiefenpsychologische Therapie</option>
                        <option value="systemisch">Systemische Therapie</option>
                        <option value="humanistisch">Humanistische Therapie</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Geplante Dauer (Wochen)</label>
                    <input type="number" class="input-field" placeholder="z.B. 12" required>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">Plan erstellen</button>
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeModal('planModal')">Abbrechen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Appointment Modal -->
    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Neuer Termin</h2>
            </div>
            <form onsubmit="createAppointment(event)">
                <div class="form-group">
                    <label class="form-label">Klient:in</label>
                    <select class="input-field" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="1">Max M.</option>
                        <option value="2">Anna S.</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Datum</label>
                    <input type="date" class="input-field" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Uhrzeit</label>
                    <input type="time" class="input-field" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Dauer (Minuten)</label>
                    <input type="number" class="input-field" value="50" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Notizen</label>
                    <textarea class="input-field" rows="2" placeholder="Optionale Notizen..."></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">Termin erstellen</button>
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeModal('appointmentModal')">Abbrechen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Todo Modal -->
    <div id="todoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Neue Aufgabe</h2>
            </div>
            <form onsubmit="createTodo(event)">
                <div class="form-group">
                    <label class="form-label">Aufgabe</label>
                    <input type="text" class="input-field" placeholder="Was muss erledigt werden?" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Beschreibung</label>
                    <textarea class="input-field" rows="2" placeholder="Details zur Aufgabe..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">F√§lligkeitsdatum</label>
                    <input type="date" class="input-field" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Priorit√§t</label>
                    <select class="input-field" required>
                        <option value="low">Niedrig</option>
                        <option value="medium" selected>Mittel</option>
                        <option value="high">Hoch</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">Aufgabe erstellen</button>
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeModal('todoModal')">Abbrechen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Team Modal -->
    <div id="teamModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Teammitglied hinzuf√ºgen</h2>
            </div>
            <form onsubmit="addTeamMember(event)">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="input-field" placeholder="Vor- und Nachname" required>
                </div>
                <div class="form-group">
                    <label class="form-label">E-Mail</label>
                    <input type="email" class="input-field" placeholder="email@example.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Rolle</label>
                    <select class="input-field" required>
                        <option value="therapeut">Therapeut</option>
                        <option value="assistenz">Assistenz</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Passwort (tempor√§r)</label>
                    <input type="password" class="input-field" placeholder="Mindestens 8 Zeichen" required minlength="8">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">Hinzuf√ºgen</button>
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeModal('teamModal')">Abbrechen</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // === AUTHENTICATION & USER INFO === //
        let currentUser = null;

        async function checkAuth() {
            try {
                const response = await fetch('/api/auth/me');
                if (!response.ok) {
                    window.location.href = '/';
                    return;
                }
                const data = await response.json();
                currentUser = data.user;
                
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userRole').textContent = currentUser.role === 'admin' ? 'Administrator' : 
                                                                  currentUser.role === 'therapeut' ? 'Therapeut' :
                                                                  'Assistenz';
                
                const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                document.getElementById('userAvatar').textContent = initials;
                
                if (currentUser.role === 'admin') {
                    document.getElementById('adminLink').style.display = 'inline-block';
                }
                
                loadTeamMembers();
            } catch (error) {
                console.error('Auth check failed:', error);
                window.location.href = '/';
            }
        }

        async function logout() {
            try {
                await fetch('/api/auth/logout', { method: 'POST' });
                window.location.href = '/';
            } catch (error) {
                console.error('Logout failed:', error);
                window.location.href = '/';
            }
        }

        // === NAVIGATION === //
        function showSection(sectionId, tabElement) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            if (tabElement) tabElement.classList.add('active');
        }

        // === MODAL FUNCTIONS === //
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // === THERAPY PLANNING === //
        function createTherapyPlan(event) {
            event.preventDefault();
            alert('Therapieplan erstellt! (Backend-Integration erforderlich)');
            closeModal('planModal');
        }

        // === CALENDAR === //
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        function generateCalendar() {
            const monthNames = ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni',
                               'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
            
            document.getElementById('currentMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Days of week headers
            const daysOfWeek = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
            daysOfWeek.forEach(day => {
                const header = document.createElement('div');
                header.style.fontWeight = 'bold';
                header.style.padding = '10px';
                header.style.textAlign = 'center';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // Calendar days
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const today = new Date();
            
            // Empty cells before first day
            for (let i = 1; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                grid.appendChild(emptyCell);
            }
            
            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                dayCell.textContent = day;
                
                if (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                    dayCell.classList.add('today');
                }
                
                // Random appointments for demo
                if (Math.random() > 0.7) {
                    dayCell.classList.add('has-appointments');
                    const badge = document.createElement('div');
                    badge.className = 'appointment-badge';
                    badge.textContent = Math.floor(Math.random() * 5) + 1;
                    dayCell.appendChild(badge);
                }
                
                grid.appendChild(dayCell);
            }
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar();
        }

        function createAppointment(event) {
            event.preventDefault();
            alert('Termin erstellt! (Backend-Integration erforderlich)');
            closeModal('appointmentModal');
            generateCalendar();
        }

        // === TODOS === //
        function toggleTodo(checkbox) {
            const todoItem = checkbox.closest('.todo-item');
            if (checkbox.checked) {
                todoItem.classList.add('completed');
            } else {
                todoItem.classList.remove('completed');
            }
        }

        function filterTodos(filter, button) {
            document.querySelectorAll('.todo-filter').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            const todos = document.querySelectorAll('.todo-item');
            const today = new Date().toISOString().split('T')[0];
            
            todos.forEach(todo => {
                const todoDate = todo.dataset.date;
                const priority = todo.dataset.priority;
                let show = true;
                
                switch(filter) {
                    case 'today':
                        show = todoDate === today;
                        break;
                    case 'week':
                        const weekFromNow = new Date();
                        weekFromNow.setDate(weekFromNow.getDate() + 7);
                        show = new Date(todoDate) <= weekFromNow;
                        break;
                    case 'high':
                        show = priority === 'high';
                        break;
                }
                
                todo.style.display = show ? 'flex' : 'none';
            });
        }

        function createTodo(event) {
            event.preventDefault();
            alert('Aufgabe erstellt! (Backend-Integration erforderlich)');
            closeModal('todoModal');
        }

        // === CHAT === //
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage('user', message);
            input.value = '';
            
            // Show loading
            const messagesDiv = document.getElementById('chatMessages');
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'chat-message assistant';
            loadingDiv.innerHTML = '<div class="chat-bubble">üí≠ KI denkt nach...</div>';
            messagesDiv.appendChild(loadingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                
                const data = await response.json();
                
                // Remove loading
                loadingDiv.remove();
                
                // Add AI response
                addChatMessage('assistant', data.reply || 'Keine Antwort erhalten.');
            } catch (error) {
                console.error('Chat error:', error);
                loadingDiv.remove();
                addChatMessage('assistant', 'Entschuldigung, es gab einen Fehler. Bitte versuche es erneut.');
            }
        }

        function addChatMessage(role, content) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role}`;
            messageDiv.innerHTML = `<div class="chat-bubble">${content}</div>`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // === TEAM === //
        async function loadTeamMembers() {
            try {
                const response = await fetch('/api/auth/users');
                if (!response.ok) return;
                
                const users = await response.json();
                const grid = document.getElementById('teamGrid');
                grid.innerHTML = '';
                
                users.forEach(user => {
                    const initials = user.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    const roleClass = user.role === 'admin' ? 'admin' : 
                                     user.role === 'therapeut' ? 'therapeut' : 'assistenz';
                    const roleText = user.role === 'admin' ? 'Admin' : 
                                    user.role === 'therapeut' ? 'Therapeut' : 'Assistenz';
                    
                    const card = document.createElement('div');
                    card.className = 'team-member-card';
                    card.innerHTML = `
                        <div class="team-avatar">${initials}</div>
                        <h3 style="margin-bottom: 5px;">${user.name}</h3>
                        <p style="color: #666; font-size: 13px; margin-bottom: 10px;">${user.email}</p>
                        <span class="team-role ${roleClass}">${roleText}</span>
                        ${currentUser.role === 'admin' ? `
                        <div style="margin-top: 15px;">
                            <button class="btn btn-success" style="padding: 8px 16px; font-size: 12px;">Bearbeiten</button>
                        </div>
                        ` : ''}
                    `;
                    grid.appendChild(card);
                });
            } catch (error) {
                console.error('Failed to load team members:', error);
            }
        }

        async function addTeamMember(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                role: formData.get('role'),
                password: formData.get('password')
            };
            
            try {
                const response = await fetch('/api/auth/add-user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    alert('Teammitglied erfolgreich hinzugef√ºgt!');
                    closeModal('teamModal');
                    loadTeamMembers();
                } else {
                    const error = await response.json();
                    alert('Fehler: ' + error.error);
                }
            } catch (error) {
                console.error('Failed to add team member:', error);
                alert('Fehler beim Hinzuf√ºgen des Teammitglieds');
            }
        }

        // === INITIALIZATION === //
        window.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            generateCalendar();
            showSection('overview', document.querySelector('.nav-tab'));
        });
    </script>
</body>
</html>
